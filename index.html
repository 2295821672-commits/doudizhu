<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¬¢ä¹äº”äººæš—å“¨-å…¨èƒ½ç‰ˆ</title>
    <style>
        /* ç»å…¸æ¬¢ä¹æ–—åœ°ä¸»è§†è§‰ */
        body { 
            background: radial-gradient(circle, #2e7d32 0%, #1b5e20 100%); 
            color: white; margin: 0; font-family: "Microsoft YaHei", sans-serif; overflow: hidden; 
        }
        .status-bar { background: rgba(0,0,0,0.4); padding: 10px; font-size: 14px; display: flex; justify-content: space-between; border-bottom: 1px solid rgba(255,255,255,0.1); }
        
        /* æ¨¡å¼åˆ‡æ¢å™¨ */
        .mode-btn { background: #ff9800; border: none; color: white; padding: 4px 12px; border-radius: 15px; font-weight: bold; cursor: pointer; }

        /* é—¹é’Ÿè®¡æ—¶å™¨ */
        #timer-box {
            position: absolute; top: 15%; left: 50%; transform: translateX(-50%);
            background: #ffeb3b; border: 3px solid #5d4037; border-radius: 50%;
            width: 40px; height: 40px; line-height: 40px; text-align: center;
            color: #5d4037; font-weight: bold; font-size: 18px; box-shadow: 0 4px 8px rgba(0,0,0,0.5);
        }

        /* ç”µè„‘ç©å®¶å ä½ï¼ˆæ¨¡æ‹Ÿå››äººï¼‰ */
        .robot-player { position: absolute; color: rgba(255,255,255,0.7); font-size: 12px; width: 60px; text-align: center; }
        .robot-1 { top: 40%; left: 5%; } .robot-2 { top: 10%; left: 20%; }
        .robot-3 { top: 10%; right: 20%; } .robot-4 { top: 40%; right: 5%; }

        /* æ“ä½œåŒº */
        .controls { position: fixed; bottom: 170px; width: 100%; text-align: center; }
        .btn { padding: 10px 35px; border-radius: 25px; border: 2px solid #fff; font-weight: bold; font-size: 18px; margin: 0 10px; box-shadow: 0 4px 0 rgba(0,0,0,0.2); transition: 0.1s; }
        .btn-pass { background: linear-gradient(to bottom, #9e9e9e, #616161); color: white; }
        .btn-play { background: linear-gradient(to bottom, #ffeb3b, #fbc02d); color: #5d4037; }
        .btn:active { transform: translateY(2px); box-shadow: none; }

        /* ç´§å‡‘æ‰‹ç‰Œæ’å¸ƒ */
        .hand-area { display: flex; justify-content: center; position: fixed; bottom: 20px; width: 100%; height: 130px; }
        .card {
            width: 65px; height: 95px; background: white; border-radius: 8px;
            color: black; margin-left: -48px; border: 1px solid #999;
            position: relative; transition: 0.2s; box-shadow: -2px 2px 5px rgba(0,0,0,0.3);
            display: flex; flex-direction: column; padding: 5px; cursor: pointer;
        }
        .card:first-child { margin-left: 0; }
        .card.selected { transform: translateY(-30px); border: 2px solid #ff9800; }
        .rank { font-size: 22px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="status-bar">
        <span id="status">æ­£åœ¨è¿›å…¥æ¸¸æˆ...</span>
        <button class="mode-btn" id="mode-toggle" onclick="toggleMode()">åˆ‡æ¢è‡³è”ç½‘æ¨¡å¼</button>
    </div>

    <div class="robot-player robot-1">ğŸ¤– ç”µè„‘1<br>(21å¼ )</div>
    <div class="robot-player robot-2">ğŸ¤– ç”µè„‘2<br>(21å¼ )</div>
    <div class="robot-player robot-3">ğŸ¤– ç”µè„‘3<br>(21å¼ )</div>
    <div class="robot-player robot-4">ğŸ¤– ç”µè„‘4<br>(21å¼ )</div>

    <div id="timer-box">120</div>

    <div class="controls">
        <button class="btn btn-pass" onclick="handlePass()">ä¸å‡º</button>
        <button class="btn btn-play" onclick="handlePlay()">å‡ºç‰Œ</button>
    </div>

    <div class="hand-area" id="player-hand"></div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        let isOnline = false;
        let myHand = [];
        let timeLeft = 120;
        let socket = null;

        // --- å•æœºç‰ˆé€»è¾‘ï¼šè‡ªåŠ¨é™ªç© ---
        function startOfflineGame() {
            isOnline = false;
            document.getElementById('status').innerText = "å½“å‰ï¼šå•æœºç»ƒä¹ å±€";
            document.getElementById('mode-toggle').innerText = "åˆ‡æ¢è‡³è”ç½‘æ¨¡å¼";
            
            let deck = [];
            const ranks = [3,4,5,6,7,8,9,10,11,12,13,14,15,16,17];
            for(let i=0; i<2; i++) ranks.forEach(r => {
                if(r < 16) [1,2,3,4].forEach(s => deck.push({rank: r, suit: s}));
                else deck.push({rank: r, suit: 0});
            });
            deck.sort(() => Math.random() - 0.5);

            myHand = deck.slice(0, 21).sort((a,b) => b.rank - a.rank);
            renderCards();
            alert("å•æœºå±€å¼€å§‹ï¼ä½ æ˜¯æ˜åœ°ä¸»ï¼Œå…¶ä»–4ä½ç”µè„‘æ˜¯ä½ çš„å¯¹æ‰‹ï¼ˆåŒ…å«ä¸€åéšè—æš—å“¨ï¼‰ã€‚");
        }

        // --- è”ç½‘ç‰ˆé€»è¾‘ ---
        function startOnlineGame() {
            isOnline = true;
            document.getElementById('status').innerText = "æ­£åœ¨å¯»æ‰¾åœ¨çº¿ç‰Œå‹...";
            document.getElementById('mode-toggle').innerText = "åˆ‡å›å•æœº";
            
            // è®°å¾—æ¢æˆä½ è‡ªå·±çš„ Zeabur åœ°å€
            socket = io('https://my-doudizhu.zeabur.app'); 
            socket.on('deal', data => {
                myHand = data.hand.sort((a,b) => b.rank - a.rank);
                renderCards();
                timeLeft = 120;
            });
            socket.on('server_msg', m => document.getElementById('status').innerText = m);
        }

        function toggleMode() {
            if(isOnline) location.reload();
            else startOnlineGame();
        }

        function renderCards() {
            const container = document.getElementById('player-hand');
            container.innerHTML = '';
            myHand.forEach(card => {
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `<span class="rank">${getRankName(card.rank)}</span>`;
                div.onclick = () => div.classList.toggle('selected');
                container.appendChild(div);
            });
        }

        function getRankName(r) {
            const names = {11:'J', 12:'Q', 13:'K', 14:'A', 15:'2', 16:'å°', 17:'å¤§'};
            return names[r] || r;
        }

        function handlePass() {
            timeLeft = 120;
            if(!isOnline) {
                const aiQuotes = ["ç”µè„‘1ï¼šç®¡ä¸ä¸Šï¼", "ç”µè„‘2ï¼šè¿‡ï¼", "ç”µè„‘3ï¼šè¦ä¸èµ·ã€‚", "ç”µè„‘4ï¼šæˆ‘ä¹Ÿè¿‡ã€‚"];
                alert(aiQuotes[Math.floor(Math.random()*4)]);
            }
        }

        function handlePlay() {
            const selected = document.querySelectorAll('.card.selected');
            if(selected.length === 0) return alert("è¯·å…ˆé€‰ç‰Œï¼");
            alert("å‡ºç‰ŒæˆåŠŸï¼ä¸¥æ ¼éµå¾ªä¼ ç»Ÿè§„åˆ™ï¼Œä¸ç¿»å€ï¼Œä¸‰å¸¦ä¸‰ç¦æ­¢å‡ºã€‚");
            // é€»è¾‘ï¼šå¦‚æœæ˜¯å•æœºï¼Œè¿™é‡Œå¯ä»¥å†™å‡ºç‰Œåçš„æ‰‹ç‰Œæ‰£é™¤
        }

        // é»˜è®¤åˆå§‹åŒ–
        startOfflineGame();

        // å…¨å±€è®¡æ—¶
        setInterval(() => {
            if(timeLeft > 0) {
                timeLeft--;
                document.getElementById('timer-box').innerText = timeLeft;
                if(timeLeft === 0) handlePass();
            }
        }, 1000);
    </script>
</body>
</html>
