<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¬¢ä¹äº”äººæš—å“¨-ç»ˆæç‰ˆ</title>
    <style>
        body { background: radial-gradient(circle, #2e7d32 0%, #1b5e20 100%); color: white; margin: 0; font-family: sans-serif; overflow: hidden; }
        .status-bar { background: rgba(0,0,0,0.4); padding: 10px; font-size: 14px; display: flex; justify-content: space-between; }
        
        /* æ¡Œé¢ä¸­å¿ƒå‡ºç‰ŒåŒº */
        #table-center { 
            position: absolute; top: 35%; left: 50%; transform: translate(-50%, -50%);
            width: 80%; height: 150px; display: flex; justify-content: center; align-items: center;
            border: 2px dashed rgba(255,255,255,0.2); border-radius: 20px;
        }

        /* é—¹é’Ÿè®¡æ—¶å™¨ */
        #timer-box { position: absolute; top: 22%; left: 50%; transform: translateX(-50%); background: #ffeb3b; border: 3px solid #5d4037; border-radius: 50%; width: 45px; height: 45px; line-height: 45px; text-align: center; color: #5d4037; font-weight: bold; box-shadow: 0 4px 8px rgba(0,0,0,0.5); }

        /* ç”µè„‘ç©å®¶æ ‡ç­¾ */
        .robot-label { position: absolute; background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 10px; font-size: 12px; }
        .r1 { top: 50%; left: 2%; } .r2 { top: 15%; left: 15%; } .r3 { top: 15%; right: 15%; } .r4 { top: 50%; right: 2%; }

        /* æŒ‰é’®ä¸æ‰‹ç‰Œ */
        .controls { position: fixed; bottom: 170px; width: 100%; text-align: center; z-index: 100; }
        .btn { padding: 10px 30px; border-radius: 25px; border: 2px solid #fff; font-weight: bold; margin: 0 10px; cursor: pointer; }
        .btn-play { background: #fbc02d; color: #5d4037; } .btn-pass { background: #616161; color: white; }

        .hand-area { display: flex; justify-content: center; position: fixed; bottom: 20px; width: 100%; height: 120px; }
        .card { width: 60px; height: 90px; background: white; border-radius: 8px; color: black; margin-left: -45px; border: 1px solid #999; box-shadow: -2px 2px 5px rgba(0,0,0,0.3); padding: 5px; cursor: pointer; transition: 0.1s; }
        .card.selected { transform: translateY(-25px); border: 2px solid #ff9800; }
        .rank { font-size: 20px; font-weight: bold; }
        
        /* å‡ºåˆ°æ¡Œé¢ä¸Šçš„ç‰Œ */
        .played-card { width: 50px; height: 75px; background: #eee; border-radius: 5px; color: black; margin: 0 5px; border: 1px solid #ccc; text-align: center; line-height: 75px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="status-bar">
        <span id="status">æ¬¢ä¹äº”äººå±€ (å•æœºæ¨¡å¼)</span>
        <span>è§„åˆ™ï¼šæš—å“¨ | ç¦ä¸‰å¸¦ä¸‰ | ä¸ç¿»å€</span>
    </div>

    <div class="robot-label r1" id="robot1-txt">ğŸ¤– ç”µè„‘1 (21å¼ )</div>
    <div class="robot-label r2" id="robot2-txt">ğŸ¤– ç”µè„‘2 (21å¼ )</div>
    <div class="robot-label r3" id="robot3-txt">ğŸ¤– ç”µè„‘3 (21å¼ )</div>
    <div class="robot-label r4" id="robot4-txt">ğŸ¤– ç”µè„‘4 (21å¼ )</div>

    <div id="table-center"></div>
    <div id="timer-box">120</div>

    <div class="controls">
        <button class="btn btn-pass" onclick="handlePass()">ä¸å‡º</button>
        <button class="btn btn-play" onclick="handlePlay()">å‡ºç‰Œ</button>
    </div>

    <div class="hand-area" id="player-hand"></div>

    <script>
        let myHand = [];
        let currentTableCards = []; // æ¡Œé¢ä¸Šçš„ç‰Œ
        let timeLeft = 120;

        function startOfflineGame() {
            let deck = [];
            const ranks = [3,4,5,6,7,8,9,10,11,12,13,14,15,16,17];
            for(let i=0; i<2; i++) ranks.forEach(r => {
                if(r < 16) [1,2,3,4].forEach(s => deck.push({rank: r, suit: s}));
                else deck.push({rank: r, suit: 0});
            });
            deck.sort(() => Math.random() - 0.5);
            myHand = deck.slice(0, 21).sort((a,b) => b.rank - a.rank);
            renderHand();
        }

        function renderHand() {
            const container = document.getElementById('player-hand');
            container.innerHTML = '';
            myHand.forEach((card, idx) => {
                const div = document.createElement('div');
                div.className = 'card' + (card.selected ? ' selected' : '');
                div.innerHTML = `<span class="rank">${getRankName(card.rank)}</span>`;
                div.onclick = () => { card.selected = !card.selected; renderHand(); };
                container.appendChild(div);
            });
        }

        function getRankName(r) {
            const names = {11:'J', 12:'Q', 13:'K', 14:'A', 15:'2', 16:'å°', 17:'å¤§'};
            return names[r] || r;
        }

        // --- æ ¸å¿ƒï¼šAI å‡ºç‰Œå¾ªç¯ ---
        async function runAILoop() {
            document.querySelector('.controls').style.display = 'none'; // è½®åˆ°AIï¼Œéšè—ä½ çš„æŒ‰é’®
            for (let i = 1; i <= 4; i++) {
                document.getElementById('status').innerText = `ç”µè„‘ ${i} æ­£åœ¨æ€è€ƒ...`;
                await new Promise(r => setTimeout(r, 1200)); // æ¨¡æ‹Ÿæ€è€ƒ1.2ç§’
                
                // æ¨¡æ‹ŸAIå‡ºç‰Œé€»è¾‘ï¼ˆç®€å•å±•ç¤ºï¼‰
                const randomAction = Math.random() > 0.3 ? 'play' : 'pass';
                if(randomAction === 'play') {
                    showTableCards([{rank: Math.floor(Math.random()*13)+3}]); // éšæœºå‡ºä¸€å¼ 
                    document.getElementById(`robot${i}-txt`).innerText = `ğŸ¤– ç”µè„‘${i} (å‡ºç‰Œ)`;
                } else {
                    document.getElementById(`robot${i}-txt`).innerText = `ğŸ¤– ç”µè„‘${i} (ä¸è¦)`;
                }
            }
            document.getElementById('status').innerText = "è½®åˆ°ä½ äº†ï¼";
            document.querySelector('.controls').style.display = 'block';
            timeLeft = 120;
        }

        function showTableCards(cards) {
            const center = document.getElementById('table-center');
            center.innerHTML = '';
            cards.forEach(c => {
                const div = document.createElement('div');
                div.className = 'played-card';
                div.innerText = getRankName(c.rank);
                center.appendChild(div);
            });
        }

        function handlePlay() {
            const selectedCards = myHand.filter(c => c.selected);
            if(selectedCards.length === 0) return;
            
            showTableCards(selectedCards);
            myHand = myHand.filter(c => !c.selected);
            renderHand();
            runAILoop();
        }

        function handlePass() {
            document.getElementById('table-center').innerHTML = '<span style="color:#aaa">ä½ é€‰æ‹©äº†ä¸å‡º</span>';
            runAILoop();
        }

        startOfflineGame();
        setInterval(() => { if(timeLeft > 0) { timeLeft--; document.getElementById('timer-box').innerText = timeLeft; } }, 1000);
    </script>
</body>
</html>
